---
description: バックエンドコードレビュー（Node.js/TypeScript/Zod）
argument-hint: [対象ファイル or 空欄で最近の変更]
---

以下のバックエンドコードをベストプラクティスに基づいてレビューしてください: $ARGUMENTS

## レビュー観点

### 🔴 セキュリティ（必須）
- SQLインジェクション、NoSQLインジェクション
- 認証・認可の欠如や不備
- 機密情報のハードコード（APIキー、パスワード等）
- 入力値の検証不足（信頼できないデータの直接使用）

### 🔴 Zodバリデーション
- 外部入力（リクエストボディ、クエリパラメータ）に対するZodスキーマの適用
- parse vs safeParse の適切な使い分け
- エラーメッセージのカスタマイズ（ユーザーフレンドリーか）
- スキーマの再利用性（重複定義を避けているか）
- z.infer による型推論の活用（型の二重定義を避ける）

### 🟡 エラーハンドリング
- try-catch の適切な使用
- エラーの適切なログ出力
- クライアントへの適切なエラーレスポンス（内部情報の露出防止）
- 非同期処理のエラー伝播（unhandled rejection の防止）

### 🟡 非同期処理・パフォーマンス
- Promise/async-awaitの適切な使用
- 並列実行可能な処理の Promise.all 活用
- N+1問題（ループ内でのDB/API呼び出し）
- 不要なawait（並列化できる処理の直列実行）

### 🟡 型安全
- any型の使用回避
- unknown + 型ガードの適切な使用
- as による型アサーションの乱用
- Zodスキーマからの型推論活用

### 🟢 API設計
- RESTful原則への準拠（適切なHTTPメソッド、ステータスコード）
- レスポンス形式の一貫性
- 適切なエラーレスポンス構造

## 出力形式

- 問題点のみ指摘
- 重要度を明示（🔴高/🟡中/🟢低）
- 具体的な修正案をコード付きで提示
- 問題なければ「LGTM 🎉」のみ

## 指摘しないこと

- ESLint/Prettierで検出できるスタイルの問題
- 好みレベルの命名・構成の提案
- 過度なパフォーマンス最適化の提案
